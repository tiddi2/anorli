<!DOCTYPE html>
<html>

<head>
    <title>AJAX: Sign Up Page</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>

<body>

    <h1> Sign Up Form </h1>

    <form onsubmit= "return false">
        <fieldset>
            <legend>Sign Up</legend>
            First Name: <input type="text" /><br />
            Last Name: <input type="text" /><br /> 
            Email: <input type="text" /><br /> 
            Phone Number:<input type="text" /><br /><br /> 
            Zip Code: <input type="text" id="zip"/> <span id="zipFeedback"></span><br /> 
            City: <span id="city"></span>
            <br/> Latitude: <span id="latitude"></span>
            <br /> Longitude: <span id="longitude"></span>
            <br /><br />
            State: <select id="state">
                <option>Select one</option>
                <option value="ak">Alaska</option>
                <option value="ca">California</option>
                <option value="hi">Hawaii</option>
                <option value="ny">New York</option>
            </select><br /> 
            Select a County: 
            <select id="county">
                <option>Select one</option>        
            </select><br /> 
            Desired Username: <input type="text" id="username" /> <img src="" id="availabilityImage"></img><br /> 
            Password: <input id="password" type="password"><br /> 
            Type Password Again: <input id="repassword" type="password">  <img src="" id="passwordMatchImage"><span id="passwordFeedback"></span><br />
            <input type="submit" value="Sign up!" />
        </fieldset>
    </form>

</body>
<script>
    $("#state").change(function() {updateState()});
    $("#zip").change(function () {getCity()});
    $("#username").change(function() { checkUsername()});
    $("#repassword").change(function() { checkPassword() })
    function checkUsername() {
        ajaxCall("http://cst352-tidemann.c9users.io/anorli/labs/lab9/checkUsernameAPI.php?",{ "username": $("#username").val()},function(data) {
            $("#availabilityImage").attr("src",(data.length == 0?"check":"xmark")+ ".png");
        });
    }
    function updateState() {
        ajaxCall("http://itcdland.csumb.edu/~milara/ajax/countyList.php",{ "state": $("#state").val()},function(data) {
            $("#county").html("<option>Select one</option>");
            for(var i = 0; i < data.length; i++) {
                $("#county").append("<option>" + data[i].county + "</option>")
            }
        });
    }
    function getCity() {
        var data = ajaxCall("http://itcdland.csumb.edu/~milara/ajax/cityInfoByZip.php",{ "zip": $("#zip").val()}, function(data) {
            if(data) {
                $("#city").html(data.city);
                $("#latitude").html(data.latitude);
                $("#longitude").html(data.longitude);
                $("#zipFeedback").html("");
            } else {
                $("#city").html("");
                $("#latitude").html("");
                $("#longitude").html("");
                $("#zipFeedback").html("Zip not found");
            }
        });

    }
    function checkPassword() {
        if($("#repassword").val() == $("#password").val()) {
            $("#passwordMatchImage").attr("src","check.png");
            $("#passwordFeedback").html("Passwords match");
        } else {
            $("#passwordFeedback").html("Passwords does not match");
            $("#passwordMatchImage").attr("src","xmark.png");
        }
    }
    
    function ajaxCall(link,data , callback) {
        $.ajax({
            type: "GET",
            url: link,
            dataType: "json",
            data: data,
            success: function(data,status) {callback(data)},
            complete: function(data,status) {console.log(status)}
        });
    }
</script>
</html>
